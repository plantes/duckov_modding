# HeadshotTip - 完整使用指南

## 🚀 快速上手（3步）

### 步骤 1：编译项目
```bash
# 双击运行
build.bat
```

### 步骤 2：部署到游戏
```bash
# 修改 deploy.bat 中的游戏路径，然后运行
deploy.bat
```

### 步骤 3：启动游戏测试
1. 启动游戏
2. 主菜单 → Mods → 启用"爆头击杀鼓励提示"
3. 重启游戏
4. 进入游戏后按 **F8** 或 **F9** 测试

---

## 🎮 测试按键说明

当前版本是**测试版本**，提供了按键测试功能：

| 按键 | 功能 | 说明 |
|------|------|------|
| **F8** | 玩家位置测试 | 在自己角色头上显示气泡 |
| **F9** | 目标位置测试 | 在鼠标瞄准的目标上显示气泡 |
| **F10** | 显示配置 | 在日志中显示当前配置信息 |

**使用建议**：
- 先按 F8 测试气泡是否正常显示
- 再按 F9 对准 NPC 或敌人测试位置是否正确
- 按 F10 查看配置是否正确加载

---

## 📁 文件说明

### 核心文件
```
headshot _tip/
├── HeadshotTip/
│   ├── ModBehaviour.cs          # 主代码（测试版本）
│   ├── ModBehaviour_Original.cs.bak  # 原始版本（备份）
│   ├── ConfigManager.cs         # 配置管理
│   ├── HeadshotTip.csproj       # 项目配置
│   └── ReleaseExample/
│       └── HeadshotTip/
│           ├── HeadshotTip.dll   # 编译输出
│           ├── info.ini          # Mod 信息
│           ├── config.json       # 用户配置
│           └── preview.png       # 预览图
└── HeadshotTip.sln              # 解决方案
```

### 脚本文件
| 脚本 | 功能 |
|------|------|
| `build.bat` | 编译项目 |
| `deploy.bat` | 部署到游戏（需配置游戏路径） |
| `clean.bat` | 清理编译输出 |
| `package.bat` | 打包发布版本 |
| `view-logs.bat` | 查看游戏日志 |

---

## ⚙️ 配置文件

### config.json 说明

位置：`HeadshotTip\ReleaseExample\HeadshotTip\config.json`

```json
{
  "enabled": true,          // 是否启用（true/false）
  "duration": 2.0,          // 显示时长（秒）
  "yOffset": 1.5,           // 垂直偏移（米）
  "messages": [             // 鼓励文字列表
    "三爷好棒",
    "三爷V5",
    "三爷牛逼"
    // ... 添加更多文字
  ]
}
```

**修改配置后需要重启游戏才能生效！**

### 自定义文字

你可以添加任意数量的鼓励文字：

```json
{
  "messages": [
    "哇，真准！",
    "666",
    "完美一枪",
    "神枪手",
    "NICE SHOT",
    "你也太强了吧",
    "这也能中？",
    "职业选手",
    "枪枪爆头",
    "无敌"
  ]
}
```

---

## 🔧 编译配置

### 修改游戏路径

如果你的游戏不在默认位置，需要修改两个文件：

#### 1. 修改编译配置（HeadshotTip.csproj）

```xml
<!-- Windows 用户 -->
<DuckovPath>你的游戏路径</DuckovPath>

<!-- 示例 -->
<DuckovPath>D:\Games\Duckov</DuckovPath>
<DuckovPath>C:\Steam\steamapps\common\Escape from Duckov</DuckovPath>
```

#### 2. 修改部署配置（deploy.bat）

```batch
REM 第 8 行左右
set "GAME_PATH=你的游戏路径"

REM 示例
set "GAME_PATH=D:\Games\Duckov"
```

---

## 📊 查看日志

### 方法 1：使用脚本（推荐）
```bash
# 双击运行
view-logs.bat
```

会自动过滤并显示 HeadshotTip 相关的日志

### 方法 2：手动查看

**日志位置**：
```
Windows: C:\Users\{用户名}\AppData\LocalLow\TeamSoda\Duckov\Player.log
macOS: ~/Library/Logs/TeamSoda/Duckov/Player.log
```

**搜索关键词**：`HeadshotTip`

**正常日志示例**：
```
[HeadshotTip] Mod 已加载 (测试版本)
[HeadshotTip] 配置加载完成，启用状态: True
[HeadshotTip] Harmony Patches 应用成功
[HeadshotTip] 测试模式已启用
```

---

## 🐛 常见问题

### 1. 编译失败：找不到类型 'TeamSoda'

**原因**：DuckovPath 配置错误

**解决**：
1. 检查游戏是否已安装
2. 打开 `HeadshotTip.csproj`
3. 修改 `<DuckovPath>` 为实际游戏路径
4. 重新运行 `build.bat`

### 2. Mod 不显示在游戏中

**检查清单**：
- [ ] 文件夹名称是否为 `HeadshotTip`
- [ ] 是否包含 `HeadshotTip.dll`
- [ ] 是否包含 `info.ini`
- [ ] 是否包含 `preview.png`
- [ ] 文件夹是否在 `{游戏目录}\Duckov_Data\Mods\` 下

### 3. 按 F8/F9 没有反应

**检查步骤**：
1. 查看日志，确认 Mod 是否加载
   ```
   [HeadshotTip] Mod 已加载
   ```

2. 查看是否有错误信息

3. 确认在游戏中（不在菜单）

4. 尝试重启游戏

### 4. 气泡不显示或显示错误

**可能原因**：
- `config.json` 格式错误
- `enabled` 设为 `false`
- `yOffset` 值过大或过小

**解决**：
1. 删除 `config.json`，让 Mod 重新生成默认配置
2. 检查 JSON 格式是否正确（可用在线工具验证）
3. 按 F10 查看配置是否正确加载

### 5. 游戏崩溃

**紧急处理**：
1. 删除或移动 Mod 文件夹
2. 查看 `Player-prev.log`（上次运行日志）
3. 查找错误信息

**避免方法**：
- 不要同时加载太多 Mod
- 确保使用正确版本的 Harmony (2.4.1)

---

## 📦 打包发布

### 创建发布包

```bash
# 双击运行
package.bat
```

会自动创建：
- `HeadshotTip_Release\` 文件夹
- `HeadshotTip_v1.0_时间戳.zip` 压缩包

### 上传到 Steam 创意工坊

1. 启动游戏
2. 主菜单 → Mods → Workshop
3. 选择"上传新 Mod"
4. 选择 `HeadshotTip_Release\HeadshotTip\` 文件夹
5. 填写描述和标签
6. 点击发布

**注意**：
- 必须有 `preview.png` (256x256)
- 标签已在 `info.ini` 中配置
- Steam 会覆写 `info.ini`，不要在其中存储额外数据

---

## 🔄 从测试版升级到正式版

### 步骤 1：反编译游戏代码

使用 ILSpy 或 dnSpy：
1. 打开 `{游戏目录}\Duckov_Data\Managed\TeamSoda.*.dll`
2. 搜索 "headshot" 或 "OnDeath"
3. 找到击杀相关的方法

详细说明：[QUICKSTART.md](QUICKSTART.md)

### 步骤 2：修改代码

打开 `ModBehaviour.cs`，找到注释的 Patch 部分：

```csharp
/*
[HarmonyPatch(typeof(CharacterMainControl), "OnDeath")]
[HarmonyPostfix]
static void OnDeath_Postfix(...)
{
    // ...
}
*/
```

根据反编译结果，取消注释并修改为实际方法

### 步骤 3：禁用测试模式

```csharp
// 在 ModBehaviour 类中
private bool testMode = false;  // 改为 false
```

或删除整个 `Update()` 方法

### 步骤 4：重新编译

```bash
build.bat
deploy.bat
```

---

## 📝 开发日志

查看完整开发过程：
- [DEVELOPMENT_GUIDE.md](DEVELOPMENT_GUIDE.md) - 详细开发指南
- [QUICKSTART.md](QUICKSTART.md) - 5分钟快速开始
- [README.md](README.md) - 项目说明

---

## 🎯 性能优化建议

### 减少触发频率

如果担心性能问题，可以增加冷却时间：

```csharp
// 在 HeadshotDetector 类中添加
private static float lastTriggerTime = 0;
private const float MIN_INTERVAL = 1.0f;  // 最小间隔 1 秒

private static async void ShowHeadshotTip(Transform enemyTransform)
{
    float currentTime = Time.time;
    if (currentTime - lastTriggerTime < MIN_INTERVAL)
        return;

    lastTriggerTime = currentTime;

    // ... 原有代码
}
```

### 限制显示数量

如果同时击杀多个敌人，可能导致大量气泡：

```csharp
private static int activeTooltips = 0;
private const int MAX_TOOLTIPS = 3;

private static async void ShowHeadshotTip(Transform enemyTransform)
{
    if (activeTooltips >= MAX_TOOLTIPS)
        return;

    activeTooltips++;

    await DialogueBubblesManager.Show(...);

    activeTooltips--;
}
```

---

## ✨ 功能扩展想法

### 1. 添加连杀提示

```csharp
private static int killStreak = 0;
private static float lastKillTime = 0;
private const float STREAK_TIMEOUT = 10f;

private static string GetMessage()
{
    if (Time.time - lastKillTime < STREAK_TIMEOUT)
    {
        killStreak++;
    }
    else
    {
        killStreak = 1;
    }
    lastKillTime = Time.time;

    if (killStreak >= 5)
        return "连杀！！！";
    else
        return config.GetRandomMessage();
}
```

### 2. 添加音效

```csharp
AudioSource.PlayClipAtPoint(headshotSound, enemyTransform.position);
```

### 3. 添加特效

```csharp
var particle = Instantiate(particlePrefab, enemyTransform.position, Quaternion.identity);
Destroy(particle, 2f);
```

### 4. 统计功能

记录爆头击杀次数、最高连杀等数据

---

## 📞 获取帮助

遇到问题？

1. **查看文档**
   - [使用指南](使用指南.md) ← 你在这里
   - [快速开始](QUICKSTART.md)
   - [开发指南](DEVELOPMENT_GUIDE.md)
   - [API 参考](../0template/API_Reference.md)

2. **查看日志**
   - 运行 `view-logs.bat`
   - 或手动打开 Player.log

3. **检查配置**
   - 游戏中按 F10 显示配置
   - 验证 config.json 格式

4. **社区支持**
   - GitHub Issues
   - Steam 社区讨论
   - Mod 开发交流群

---

**祝你游戏愉快！** 🎮

如有问题或建议，欢迎反馈！
